@{
    ViewBag.Title = "Staff Product List";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Products</h2>

<table id="products" class="table table-bordered table-hover">
    <thead>
        <tr>
            <th>Product</th>
            <th>Description</th>
            <th>Colour</th>
            <th>Supplier</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>

@section scripts
{
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/datatables.min.css"/>
 
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.32/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/bs4/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-flash-1.5.1/b-html5-1.5.1/b-print-1.5.1/datatables.min.js"></script>

    <script>
        $(document).ready(function () {
                var table = $("#products").DataTable({
                    ajax: {
                        url: "/api/product",
                        method: "GET",
                    dataSrc: ""
                    },
                    dom: "Bfrtip",
                    buttons: [
                        'excel',
                        'pdf'
                    ],
                columns: [
                    {
                        data: "Name",
                        render: function (data, type, product) {                         
                            return "<a href='/product/edit/" + product.Id + "'>" + product.Name + "</a>";
                        }
                    },
                    {
                        data: "Description"
                    },
                    {
                        data: "Colour"
                    },
                    {
                        data: "Supplier.Name"
                    },
                    {
                        data: "Price"
                    },
                    {
                        data: "Stock"
                    },
                    {
                        data: "Id",
                        render: function (data) {
                            console.log(data);
                            return "<button class='btn btn-primary js-delete' data-product-id=" + data + ">Delete</button>";
                        }
                    }
                ]
            });
            
            $("#products").on("click",
                ".js-delete",
                function() {
                    var button = $(this);
                    bootbox.confirm("Are you sure you want to delete this product?",
                        function(result) {
                            if (result) {
                                $.ajax({
                                    url: "/api/product/" + button.attr("data-product-id"),
                                    method: "DELETE",
                                    success: function () {
                                        console.log("HELLO");
                                        table.row(button.parents("tr")).remove().draw();
                                    }
                                });
                            }
                        });
                });
        });
    </script>
}

